<!DOCTYPE html>
<html>
<head>
    <title>Profil Saya</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Profil Saya</h2>
        
        {% if formulir %}
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="mb-3">Status Verifikasi</h5>
                {% set progress = 100 if formulir.verifikasi_status == 'approved' and formulir.pembayaran_status == 'approved'
                            else 75 if formulir.verifikasi_status == 'approved'
                            else 50 if formulir.verifikasi_status == 'pending'
                            else 25 if formulir.verifikasi_status == 'rejected'
                            else 0 %}
                <div class="progress" style="height: 25px;">
                    <div class="progress-bar {{ 'bg-success' if formulir.verifikasi_status == 'approved' and formulir.pembayaran_status == 'approved'
                                        else 'bg-info' if formulir.verifikasi_status == 'approved'
                                        else 'bg-warning' if formulir.verifikasi_status == 'pending'
                                        else 'bg-danger' }}" 
                         role="progressbar" 
                         style="width: {{ progress }}%"
                         aria-valuenow="{{ progress }}" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                        {{ "Selesai" if formulir.verifikasi_status == 'approved' and formulir.pembayaran_status == 'approved'
                           else "Menunggu Pembayaran" if formulir.verifikasi_status == 'approved'
                           else formulir.verifikasi_status|title if formulir.verifikasi_status 
                           else 'Belum Mengisi' }} - {{ progress }}%
                    </div>
                </div>
                <div class="small mt-2 text-muted">
                    {% if formulir.verifikasi_status == 'approved' and formulir.pembayaran_status == 'approved' %}
                        Selamat! Pendaftaran Anda telah selesai
                    {% elif formulir.verifikasi_status == 'approved' %}
                        Pendaftaran disetujui, silakan lakukan pembayaran
                    {% elif formulir.verifikasi_status == 'pending' %}
                        Menunggu verifikasi admin
                    {% elif formulir.verifikasi_status == 'rejected' %}
                        Pendaftaran ditolak, silahkan periksa kembali dokumen Anda
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Data Pribadi</h5>
                {% if formulir %}
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Nama Lengkap:</strong> {{ formulir.nama_lengkap }}</p>
                            <p><strong>Tempat Lahir:</strong> {{ formulir.tempat_lahir }}</p>
                            <p><strong>Tanggal Lahir:</strong> {{ formulir.tanggal_lahir }}</p>
                            <p><strong>Jenis Kelamin:</strong> {{ formulir.jenis_kelamin }}</p>
                            <p><strong>Alamat:</strong> {{ formulir.alamat }}</p>
                            <p><strong>Asal Sekolah:</strong> {{ formulir.asal_sekolah }}</p>
                            <p><strong>Jurusan:</strong> {{ formulir.jurusan }}</p>
                            <p><strong>No. HP:</strong> {{ formulir.no_hp }}</p>
                            <p><strong>Status Verifikasi:</strong> {{ formulir.verifikasi_status }}</p>
                        </div>
                        <div class="col-md-6">
                            {% if formulir.foto_path %}
                            <p><strong>Foto:</strong><br>
                                <img src="{{ url_for('uploaded_file', filename=formulir.foto_path) }}" 
                                     class="img-fluid" style="max-width: 200px">
                            </p>
                            {% endif %}
                            
                            {% if formulir.ijazah_path %}
                            <p><strong>Ijazah:</strong><br>
                                <a href="{{ url_for('uploaded_file', filename=formulir.ijazah_path) }}" 
                                   target="_blank">Lihat Ijazah</a>
                            </p>
                            {% endif %}
                            
                            {% if formulir.pembayaran_path %}
                            <p><strong>Bukti Pembayaran:</strong><br>
                                <a href="{{ url_for('uploaded_file', filename=formulir.pembayaran_path) }}" 
                                   target="_blank">Lihat Bukti Pembayaran</a>
                            </p>
                            {% endif %}
                        </div>
                    </div>

                    {% if formulir.verifikasi_status == 'approved' %}
                    <div class="mt-3">
                        <h5>Status Pembayaran</h5>
                        {% if formulir.pembayaran_status == 'approved' %}
                            <div class="alert alert-success">Pembayaran telah diverifikasi dan diterima</div>
                        {% elif formulir.pembayaran_status == 'pending' %}
                            <div class="alert alert-warning">Pembayaran sedang diverifikasi</div>
                        {% elif formulir.pembayaran_status == 'rejected' %}
                            <div class="alert alert-danger">
                                Pembayaran ditolak. Silakan upload ulang bukti pembayaran yang valid.
                                <a href="{{ url_for('pembayaran') }}" class="btn btn-primary mt-2">Upload Ulang Pembayaran</a>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                Belum melakukan pembayaran
                                {% if formulir.verifikasi_status == 'approved' %}
                                    <a href="{{ url_for('pembayaran') }}" class="btn btn-primary mt-2">Upload Pembayaran</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                    {% endif %}
        
                {% else %}
                    <p>Anda belum mengisi formulir pendaftaran.</p>
                    <a href="{{ url_for('verifikasi') }}" class="btn btn-primary">Isi Formulir</a>
                {% endif %}
            </div>
        </div>
        <a href="{{ url_for('index') }}" class="btn btn-secondary mt-3">Kembali ke Beranda</a>
    </div>
</body>
</html>
